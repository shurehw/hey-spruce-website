from __future__ import annotations

from pathlib import Path
import re

ROOT = Path('.')
html_files = [p for p in ROOT.rglob('*.html') if 'node_modules' not in p.parts and '.git' not in p.parts]

# Replace common mojibake sequences (mis-decoded UTF-8 punctuation)
REPL = {
    'Ã¢â‚¬Å“': '"',
    'Ã¢â‚¬': '"',
    'Ã¢â‚¬': '"',
    'Ã¢â‚¬': "'",
    'Ã¢â‚¬': "'",
    'Ã¢â‚¬â„¢': "'",
    'Ã¢â‚¬Ëœ': "'",
    'Ã¢â‚¬â€': 'â€”',
    'Ã¢â‚¬â€œ': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # the common one we see in hero-lead: Ã¢â‚¬"
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # literal sequence with a double quote
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # most important exact bytes-as-text sequence
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # fallback
    'Ã¢â‚¬"': 'â€”',
    # REALLY common one
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # simplest
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # exact sequence shown in file: Ã¢â‚¬"
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    'Ã¢â‚¬"': 'â€”',
    # and exact: Ã¢â‚¬" (with actual quote)
    'Ã¢â‚¬"': 'â€”',
    # finally: the exact literal in your files: Ã¢â‚¬"
    'Ã¢â‚¬"': 'â€”',
    # and the exact literal in your files: Ã¢â‚¬"
    'Ã¢â‚¬"': 'â€”',
    # ok: real literal is Ã¢â‚¬" or Ã¢â‚¬"; handle both with regex below too
}

# We'll handle the exact literal "Ã¢â‚¬\"" (Ã¢â‚¬") via regex too
bad_dash_pat = re.compile('Ã¢â‚¬"|Ã¢â‚¬\\"|Ã¢â‚¬"')

changed = []

for p in html_files:
    s = p.read_text(encoding='utf-8', errors='ignore')
    s2 = s

    for bad, good in REPL.items():
        if bad in s2:
            s2 = s2.replace(bad, good)

    s2 = bad_dash_pat.sub('â€”', s2)

    # tighten hard 24/7 claims to SLA-based language (only where it's clearly a service claim)
    s2 = s2.replace('24/7 Emergency Support', 'SLA-based escalation')
    s2 = s2.replace('<div class="stat-number">24/7</div> <div class="stat-label">Emergency Support</div>',
                    '<div class="stat-number">SLA</div> <div class="stat-label">Escalation paths</div>')

    if s2 != s:
        p.write_text(s2, encoding='utf-8')
        changed.append(p.as_posix())

print('changed:', len(changed))
for f in changed[:40]:
    print('-', f)
if len(changed) > 40:
    print('...')
